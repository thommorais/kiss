{"version":3,"sources":["scripts/videos.js"],"names":["iO","opts","list","callback","unobserve","config","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","target","observable","observe","showIntroLettering","requestAnimationFrame","document","querySelector","classList","add","showScrollIcon","handleVideoIntro","video","control","unlocked","lettering","duration","addEventListener","handleTimeUpdates","currentTime","unlock","unlockScroll","removeEventListener","loadVideo","source","children","videoSource","tagName","src","dataset","mobile","desktop","load","play","addsPlaybutton","reload","playButton","cloneNode","remove","style","opacity","parentElement","appendChild","loadGalleryVideos","mosaicVideos","querySelectorAll","galleryVideos","root","rootMargin","treshold","videoIsPlayble","undefined","catch","loadDepoimentVideos","desk","poster","threshold","section","handleCreditsVideo","wrapper","videoFooter","title","hideLettering","e","elapsedTime","pause","requestIdleCallback","handleVideos"],"mappings":"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","file":"videos.ae90c110.js","sourceRoot":"..","sourcesContent":["import isMobile from 'is-mobile'\nimport {percentage, hideElement, unlockScroll} from './helpers'\n\n\n/**\n *\n * @param {*} opts config * list * callback * unobserve\n */\nfunction iO(opts){\n\n    const {\n        list = [],\n        callback = () => null,\n        unobserve = false,\n        config = {}\n    } = opts\n\n    const observer = new IntersectionObserver(entries => {\n\n        entries.forEach(entry => {\n            const {isIntersecting, target} = entry\n            if (isIntersecting) {\n                callback(target, entry)\n                if(unobserve){\n                    observer.unobserve(target)\n                }\n            }\n        })\n\n    }, config)\n\n    list.forEach(observable => observer.observe(observable))\n\n}\n\n\nexport function showIntroLettering() {\n    requestAnimationFrame(() => {\n        const letteringIntro = document.querySelector('.lettering-intro')\n        letteringIntro.classList.add('active')\n    })\n\n}\n\nexport function showScrollIcon(){\n    requestAnimationFrame(() => {\n        const scrollingIcon = document.querySelector('.scrolling-icon')\n        scrollingIcon.classList.add('active')\n    })\n}\n\n/**\n * @desc handles the intro video\n * @param {Element} video\n * @returns {Object} with promises\n */\nfunction handleVideoIntro(video) {\n\n    const control = {\n        unlocked: false,\n        lettering: false,\n        duration: video.duration\n    }\n\n    function handleTimeUpdates() {\n\n        if(video.currentTime >= 2 && !control.lettering){\n            // this should not be here, but who got time. 🚨❌🚨\n            control.lettering = true\n            showIntroLettering()\n            // this should not be here, but who got time.\n        }\n\n        if(video.currentTime >= 3 && !control.unlock){\n            control.unlocked = true\n            requestAnimationFrame(unlockScroll)\n            requestAnimationFrame(showScrollIcon)\n        }\n\n        if(video.currentTime >= 6){\n            video.removeEventListener('timeupdate', handleTimeUpdates, false)\n        }\n\n    }\n\n    video.addEventListener('timeupdate', handleTimeUpdates, false)\n}\n\n/**\n * @desc load videos basead on device\n * @param {Element} video\n */\nexport function loadVideo(video, opts = {}){\n    for (var source in video.children) {\n        const videoSource = video.children[source]\n        if (typeof videoSource.tagName === 'string' && videoSource.tagName === 'SOURCE') {\n            if(!videoSource.src){\n                const {mobile, desktop} = videoSource.dataset\n                videoSource.src = (isMobile() && mobile) ? mobile : desktop\n                video.load()\n                if(opts.play){\n                    requestAnimationFrame(() => video.play())\n                }\n            }\n        }\n    }\n}\n\nfunction addsPlaybutton(video){\n    let reload = false\n    const playButton = document.querySelector('.play-video').cloneNode(true)\n    playButton.classList.remove('hidden')\n    playButton.addEventListener('click', () => {\n        video.play()\n        if(reload){\n            video.currentTime = 0.01\n        }\n        reload = false\n    })\n\n    video.addEventListener('play', () => {\n        playButton.style.opacity = 0\n    })\n\n    video.addEventListener('pause', () => {\n        playButton.style.opacity = 1\n    })\n\n    video.addEventListener('ended', () => {\n        reload = true\n        playButton.style.opacity = 1\n    })\n\n    video.parentElement.appendChild(playButton)\n}\n\nfunction loadGalleryVideos(){\n\n    const config = {\n        root: null,\n        rootMargin: '-25% 0px 0px -25%',\n        treshold: 1\n    }\n\n    const mosaicVideos = document.querySelectorAll('.mosaic-video video')\n    const galleryVideos = document.querySelectorAll('.gallery-video video')\n\n    iO({\n        config,\n        callback: (target) => {\n            loadVideo(target)\n            const videoIsPlayble = target.play()\n            if (videoIsPlayble !== undefined) {\n                videoIsPlayble.catch(() => addsPlaybutton(target))\n            }\n        },\n        unobserve: true,\n        list: [...mosaicVideos, ...galleryVideos],\n    })\n\n}\n\nfunction loadDepoimentVideos(){\n\n    const observer = new IntersectionObserver(entries => {\n        entries.forEach(entry => {\n            const {isIntersecting, target} = entry\n            const video = target.querySelector('video')\n            if (isIntersecting) {\n                 loadVideo(video)\n                 if(!isMobile()){\n                     addsPlaybutton(video)\n                     const { desk } = video.dataset\n                     if (desk) {\n                        video.poster = desk\n                     }\n                 }\n                 observer.unobserve(target)\n            }\n        })\n\n    }, {\n        root: null,\n        rootMargin: '0px',\n        threshold: 0\n    })\n\n    const videos = document.querySelectorAll('.video:not(.intro)')\n\n    videos.forEach(section => observer.observe(section))\n\n\n}\n\nfunction handleCreditsVideo(){\n\n    const wrapper = document.querySelector('.credits')\n    const videoFooter = wrapper.querySelector('.video-footer video')\n    const title = document.querySelector('.last-title')\n\n    function hideLettering(e){\n\n        const elapsedTime = percentage(e.target.currentTime, e.target.duration)\n\n        if (elapsedTime >= 98) {\n            requestAnimationFrame(() => videoFooter.pause())\n            videoFooter.removeEventListener('timeupdate', hideLettering)\n        }\n\n        if (elapsedTime >= 5) {\n            wrapper.classList.add('active')\n        }\n\n        if (elapsedTime >= 7) {\n            hideElement(title)\n        }\n\n        if (elapsedTime >= 9) {\n            wrapper.classList.add('show-credits')\n        }\n\n    }\n\n    videoFooter.addEventListener('timeupdate', hideLettering)\n    // videoFooter.defaultPlaybackRate = 5\n\n\n    const config = {\n        root: null,\n        rootMargin: '0px',\n        threshold: 0.1\n    }\n\n   iO({\n        config,\n        callback: videoFooter => {\n            requestIdleCallback(() => {\n                loadVideo(videoFooter)\n                videoFooter.currentTime = 0.09\n                videoFooter.play()\n            })\n        },\n        unobserve: true,\n        list: [videoFooter],\n    })\n\n}\n\nfunction handleVideos(){\n    loadDepoimentVideos()\n    loadGalleryVideos()\n    handleCreditsVideo()\n}\n\nexport { handleVideoIntro, handleVideos }\n"]}